# 貪欲法

貪欲法は常に最適解を得ることができるわけではないが、"良い性質"を有している場合では有効となる。


##  貪欲法のパターン(1): 範囲の絞り込み

貪欲法に限らず、最適化問題では以下のように考える範囲を絞れないかと考えることが多い。


$x$ の関数 $f(x)$ の最大値を考えるとする。任意の $x$ に対してある性質 $P$ が成立するような $x$ が存在してそれを $x\prime$ とする。
このとき

$$
f(x^{\prime}) > f(x) \tag{1}
$$

が成立するとする。このとき $x$ 全体のうち $P$ を満たすもののみに絞って考えたとしてもその中に $f(x)$ を最大とするような $x$ が存在する。

### 区間スケジューリング問題

0. 各区間が格納された配列を右端の数値の大小関係でソートする。
1. 全区間のうち右端の値が一番小さいものを $p$ とすると $p$ を可能な区間として選ぶことが可能である。これについては以下で示す。

- 具体的には、任意の区間の選び方に対して選ぶ区間の個数を減らすことなくその中に区間 $p$ が含まれるように変更を加えることが可能であることを示す。
( $p$ を選んだとしても最適解に辿り着ける)

任意の区間の選び方 $x$ において,最も左側にある区間を $p^{\prime}$ とする。このとき $p$ の定義から


$$ 
p.\text{right} \le p^{\prime}.\text{right} \tag{2} 
$$

を満たす。


一方、 $x$ において $p^{\prime}$ 以外の任意の区間 $q$ を考えると

$$
p^{\prime}.\text{right} \le q.\text{left} \tag{3} 
$$

(2),(3)をまとめると

$$
p.\text{right} \le q.\text{left} \tag{4}
$$


以上から、区間の選び方 $x$ において $p^{\prime}$ ,を $p$ と交換しても
(先に $p^{\prime}$ を先に選び方 $x$ を満たす区間として選んだとしても選ばれる区間数は変わらない)
選んだ区間の個数を悪化させる(少なくなる)ことなく、
区間の重なりがない状態を保持していることがわかった。

これよりこの`区間スケージューリング問題`は以下の戦略で解くことが出来る。

- `A`: 存在する区間のうち終端時刻が最小なものを選ぶ(この部分が貪欲法)
- `B`: その選んだ区間と重なる区間を削除する(すなわち選んだ区間の終端時刻よりも開始時刻が早いものを削除する)
- この操作`A`,`B`を区間がなくなるまで繰り返す。


## 貪欲法のパターン(2):現在がよいほど未来も良い(単調性に着目する)

 $N$ ステップ反復して、最終的にスコアを最大化(最小化)する最適化問題を考えるときに、
$i$ ステップまでのスコアが良ければ良いほど残りのステップで最適化して得られる最終的なスコアが良くなるような構造があるとき貪欲法が有効である。

### AGC 009 A - Multiple Array

この問題は

$N$ 個のボタン $0,1,\ldots,N-1$ を押す回数をそれぞれ $D_0, D_1,\ldots, D_{N-1}$ とするときそのの和

$$
\begin{align}
    \sum_{i=0}^{N-1} D_i
\end{align}
$$

の最小値を求める問題と言える。

このとき題意は

$$
\begin{align}
    &A_0 + (D_0 + D_1 + \ldots + D_{N-1}) \propto B_0 \\
    &A_1 + (D_1 + D_2 + \ldots + D_{N-1}) \propto B_0 \\
    &\vdots \\
    &A_{N-1} + D_{N-1} \propto B_0 \\
\end{align}
$$

であるので $D_i$ を $D_{N-1}$ から決定して行くことを考える。
ここで簡単のため

$$
\begin{align}
    a &= A_{N-1}\\
    b &= B_{N-1}\\
    d &= D_{N-1}\\
\end{align}
$$

とする。このとき $a$ が $b$ の倍数か否かで場合分けすると

(i) $a$ が $b$ の倍数のとき $d = 0,b,2b,\ldots$

(ii) $a$ が $b$ の倍数でないとき $r$ を $a$ $b$ で割った余りとして $d = b - r,2b - r, 3b - r, \ldots$

ここで $D_i \quad ( D_i > 0)$ の和の最小値を求めたいので $D_{N-1}$ を大きくとるメリットはない。

そのため、以下のように決定していけば良い。

- $A_{N-1}$ が $B_{N-1}$ の倍数であるときは $D_{N-1} = 0$ とする
- $A_{N-1}$ が $B_{N-1}$ の倍数でないときは $D_{N-1} = B_{N-1} - r$ とする

ここで、$r$ は $A_{N-1}$ を $B_{N-1}$ で割った余りとする。

更にその後の $D_{N-2},\ldots, D_{2}, D_{1}, D_{0}$ も同様に決定して行けば良い。
